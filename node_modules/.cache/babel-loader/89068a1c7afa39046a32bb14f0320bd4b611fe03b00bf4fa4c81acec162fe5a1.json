{"ast":null,"code":"import _slicedToArray from \"/Users/nicolasarchila/Documents/Arquitectura/amplify/juanv2/react-amplify-poc/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _regeneratorRuntime from \"/Users/nicolasarchila/Documents/Arquitectura/amplify/juanv2/react-amplify-poc/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport { __awaiter } from '../../node_modules/tslib/tslib.es6.mjs';\nimport React, { useContext, useMemo, useEffect } from 'react';\nimport { useInterpret } from '@xstate/react';\nimport { Auth } from 'aws-amplify';\nimport { createAuthenticatorMachine, listenToAuthHub, defaultAuthHubHandler } from '@aws-amplify/ui';\nimport { AuthenticatorContext } from './AuthenticatorContext.mjs';\nvar createHubHandler = function createHubHandler(options) {\n  return function (data, service) {\n    return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return defaultAuthHubHandler(data, service, options);\n          case 2:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee);\n    }));\n  };\n};\nfunction AuthenticatorProvider(_ref) {\n  var children = _ref.children;\n  // `authStatus` is exposed by `useAuthenticator` but should not be derived directly from the\n  // state machine as the machine only updates on `Authenticator` initiated events, which\n  // leads to scenarios where the state machine `authStatus` gets \"stuck\". For exmample,\n  // if a user was to sign in using `Auth.signIn` directly rather than using `Authenticator`\n  var _React$useState = React.useState('configuring'),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    authStatus = _React$useState2[0],\n    setAuthStatus = _React$useState2[1];\n  // only run on first render\n  React.useEffect(function () {\n    Auth.currentAuthenticatedUser().then(function () {\n      setAuthStatus('authenticated');\n    }).catch(function () {\n      setAuthStatus('unauthenticated');\n    });\n  }, []);\n  /**\n   * Based on use cases, developer might already have added another Provider\n   * outside Authenticator. In that case, we sync the two providers by just\n   * passing the parent value.\n   *\n   * TODO(BREAKING): enforce only one provider in App tree\n   */\n  var parentProviderVal = useContext(AuthenticatorContext);\n  var service = useInterpret(createAuthenticatorMachine);\n  var value = useMemo(function () {\n    return !parentProviderVal ? {\n      authStatus: authStatus,\n      service: service\n    } : parentProviderVal;\n  }, [authStatus, parentProviderVal, service]);\n  var activeService = value.service;\n  useEffect(function () {\n    var onSignIn = function onSignIn() {\n      setAuthStatus('authenticated');\n    };\n    var onSignOut = function onSignOut() {\n      setAuthStatus('unauthenticated');\n    };\n    var unsubscribe = listenToAuthHub(activeService, createHubHandler({\n      onSignIn: onSignIn,\n      onSignOut: onSignOut\n    }));\n    return unsubscribe;\n  }, [activeService]);\n  return React.createElement(AuthenticatorContext.Provider, {\n    value: value\n  }, children);\n}\nexport { AuthenticatorProvider as default };","map":{"version":3,"names":["__awaiter","React","useContext","useMemo","useEffect","useInterpret","Auth","createAuthenticatorMachine","listenToAuthHub","defaultAuthHubHandler","AuthenticatorContext","createHubHandler","options","data","service","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","stop","AuthenticatorProvider","_ref","children","_React$useState","useState","_React$useState2","_slicedToArray","authStatus","setAuthStatus","currentAuthenticatedUser","then","catch","parentProviderVal","value","activeService","onSignIn","onSignOut","unsubscribe","createElement","Provider","default"],"sources":["/Users/nicolasarchila/Documents/Arquitectura/amplify/juanv2/react-amplify-poc/node_modules/@aws-amplify/ui-react-core/dist/esm/Authenticator/context/AuthenticatorProvider.mjs"],"sourcesContent":["import { __awaiter } from '../../node_modules/tslib/tslib.es6.mjs';\nimport React, { useContext, useMemo, useEffect } from 'react';\nimport { useInterpret } from '@xstate/react';\nimport { Auth } from 'aws-amplify';\nimport { createAuthenticatorMachine, listenToAuthHub, defaultAuthHubHandler } from '@aws-amplify/ui';\nimport { AuthenticatorContext } from './AuthenticatorContext.mjs';\n\nconst createHubHandler = (options) => (data, service) => __awaiter(void 0, void 0, void 0, function* () {\n    yield defaultAuthHubHandler(data, service, options);\n});\nfunction AuthenticatorProvider({ children, }) {\n    // `authStatus` is exposed by `useAuthenticator` but should not be derived directly from the\n    // state machine as the machine only updates on `Authenticator` initiated events, which\n    // leads to scenarios where the state machine `authStatus` gets \"stuck\". For exmample,\n    // if a user was to sign in using `Auth.signIn` directly rather than using `Authenticator`\n    const [authStatus, setAuthStatus] = React.useState('configuring');\n    // only run on first render\n    React.useEffect(() => {\n        Auth.currentAuthenticatedUser()\n            .then(() => {\n            setAuthStatus('authenticated');\n        })\n            .catch(() => {\n            setAuthStatus('unauthenticated');\n        });\n    }, []);\n    /**\n     * Based on use cases, developer might already have added another Provider\n     * outside Authenticator. In that case, we sync the two providers by just\n     * passing the parent value.\n     *\n     * TODO(BREAKING): enforce only one provider in App tree\n     */\n    const parentProviderVal = useContext(AuthenticatorContext);\n    const service = useInterpret(createAuthenticatorMachine);\n    const value = useMemo(() => (!parentProviderVal ? { authStatus, service } : parentProviderVal), [authStatus, parentProviderVal, service]);\n    const { service: activeService } = value;\n    useEffect(() => {\n        const onSignIn = () => {\n            setAuthStatus('authenticated');\n        };\n        const onSignOut = () => {\n            setAuthStatus('unauthenticated');\n        };\n        const unsubscribe = listenToAuthHub(activeService, createHubHandler({ onSignIn, onSignOut }));\n        return unsubscribe;\n    }, [activeService]);\n    return (React.createElement(AuthenticatorContext.Provider, { value: value }, children));\n}\n\nexport { AuthenticatorProvider as default };\n"],"mappings":";;AAAA,SAASA,SAAS,QAAQ,wCAAwC;AAClE,OAAOC,KAAK,IAAIC,UAAU,EAAEC,OAAO,EAAEC,SAAS,QAAQ,OAAO;AAC7D,SAASC,YAAY,QAAQ,eAAe;AAC5C,SAASC,IAAI,QAAQ,aAAa;AAClC,SAASC,0BAA0B,EAAEC,eAAe,EAAEC,qBAAqB,QAAQ,iBAAiB;AACpG,SAASC,oBAAoB,QAAQ,4BAA4B;AAEjE,IAAMC,gBAAgB,GAAG,SAAnBA,gBAAgBA,CAAIC,OAAO;EAAA,OAAK,UAACC,IAAI,EAAEC,OAAO;IAAA,OAAKd,SAAS,CAAC,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,eAAAe,mBAAA,GAAAC,IAAA,CAAE,SAAAC,QAAA;MAAA,OAAAF,mBAAA,GAAAG,IAAA,UAAAC,SAAAC,QAAA;QAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;UAAA;YAAAF,QAAA,CAAAE,IAAA;YACvF,OAAMb,qBAAqB,CAACI,IAAI,EAAEC,OAAO,EAAEF,OAAO,CAAC;UAAA;UAAA;YAAA,OAAAQ,QAAA,CAAAG,IAAA;QAAA;MAAA,GAAAN,OAAA;IAAA,CACtD,EAAC;EAAA;AAAA;AACF,SAASO,qBAAqBA,CAAAC,IAAA,EAAgB;EAAA,IAAbC,QAAQ,GAAAD,IAAA,CAARC,QAAQ;EACrC;EACA;EACA;EACA;EACA,IAAAC,eAAA,GAAoC1B,KAAK,CAAC2B,QAAQ,CAAC,aAAa,CAAC;IAAAC,gBAAA,GAAAC,cAAA,CAAAH,eAAA;IAA1DI,UAAU,GAAAF,gBAAA;IAAEG,aAAa,GAAAH,gBAAA;EAChC;EACA5B,KAAK,CAACG,SAAS,CAAC,YAAM;IAClBE,IAAI,CAAC2B,wBAAwB,CAAC,CAAC,CAC1BC,IAAI,CAAC,YAAM;MACZF,aAAa,CAAC,eAAe,CAAC;IAClC,CAAC,CAAC,CACGG,KAAK,CAAC,YAAM;MACbH,aAAa,CAAC,iBAAiB,CAAC;IACpC,CAAC,CAAC;EACN,CAAC,EAAE,EAAE,CAAC;EACN;AACJ;AACA;AACA;AACA;AACA;AACA;EACI,IAAMI,iBAAiB,GAAGlC,UAAU,CAACQ,oBAAoB,CAAC;EAC1D,IAAMI,OAAO,GAAGT,YAAY,CAACE,0BAA0B,CAAC;EACxD,IAAM8B,KAAK,GAAGlC,OAAO,CAAC;IAAA,OAAO,CAACiC,iBAAiB,GAAG;MAAEL,UAAU,EAAVA,UAAU;MAAEjB,OAAO,EAAPA;IAAQ,CAAC,GAAGsB,iBAAiB;EAAA,CAAC,EAAE,CAACL,UAAU,EAAEK,iBAAiB,EAAEtB,OAAO,CAAC,CAAC;EACzI,IAAiBwB,aAAa,GAAKD,KAAK,CAAhCvB,OAAO;EACfV,SAAS,CAAC,YAAM;IACZ,IAAMmC,QAAQ,GAAG,SAAXA,QAAQA,CAAA,EAAS;MACnBP,aAAa,CAAC,eAAe,CAAC;IAClC,CAAC;IACD,IAAMQ,SAAS,GAAG,SAAZA,SAASA,CAAA,EAAS;MACpBR,aAAa,CAAC,iBAAiB,CAAC;IACpC,CAAC;IACD,IAAMS,WAAW,GAAGjC,eAAe,CAAC8B,aAAa,EAAE3B,gBAAgB,CAAC;MAAE4B,QAAQ,EAARA,QAAQ;MAAEC,SAAS,EAATA;IAAU,CAAC,CAAC,CAAC;IAC7F,OAAOC,WAAW;EACtB,CAAC,EAAE,CAACH,aAAa,CAAC,CAAC;EACnB,OAAQrC,KAAK,CAACyC,aAAa,CAAChC,oBAAoB,CAACiC,QAAQ,EAAE;IAAEN,KAAK,EAAEA;EAAM,CAAC,EAAEX,QAAQ,CAAC;AAC1F;AAEA,SAASF,qBAAqB,IAAIoB,OAAO"},"metadata":{},"sourceType":"module","externalDependencies":[]}